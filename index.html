function solvePuzzle() {
  if (!isSolvable(currentState)) {
    alert("Puzzle is not solvable!");
    return;
  }

  // Show loading message
  loading.style.display = "block";

  // Initialize Web Worker for solving
  const worker = new Worker("solver.js");

  worker.postMessage({ puzzle: currentState });

  // Receive solved steps and rejected moves from the Web Worker
  worker.onmessage = function (event) {
    const { solution, rejectedMoves } = event.data;
    if (!solution) {
      alert("No solution found!");
      loading.style.display = "none";
      return;
    }

    // Display solution steps
    let i = 0;
    const interval = setInterval(() => {
      if (i > 0) {
        // Calculate direction of move
        const prevState = solution[i - 1];
        const currState = solution[i];
        
        const zeroPrev = prevState.indexOf(0);
        const zeroCurr = currState.indexOf(0);
        const prevRow = Math.floor(zeroPrev / 4);
        const prevCol = zeroPrev % 4;
        const currRow = Math.floor(zeroCurr / 4);
        const currCol = zeroCurr % 4;

        let direction = '';
        if (currRow === prevRow - 1) direction = directionArrows.up;
        else if (currRow === prevRow + 1) direction = directionArrows.down;
        else if (currCol === prevCol - 1) direction = directionArrows.left;
        else if (currCol === prevCol + 1) direction = directionArrows.right;

        const arrowDiv = document.createElement("div");
        arrowDiv.className = "arrow";
        arrowDiv.textContent = direction;
        puzzleContainer.appendChild(arrowDiv);
      }

      // Display current puzzle state
      const puzzle = createPuzzle(solution[i]);
      const stepContainer = document.createElement("div");
      stepContainer.classList.add("step-container");
      stepContainer.appendChild(puzzle);

      puzzleContainer.appendChild(stepContainer);
      i++;
      if (i >= solution.length) {
        clearInterval(interval);
        loading.style.display = "none"; // Hide loading message after solving
      }
    }, 1000);

    // Display rejected moves
    const rejectedContainer = document.createElement("div");
    rejectedContainer.className = "rejected-moves";
    rejectedContainer.innerHTML = "<h3>Rejected Moves:</h3>";

    rejectedMoves.forEach(rejected => {
      const rejectedDiv = document.createElement("div");
      rejectedDiv.className = "rejected-move";
      rejectedDiv.innerHTML = `
        <p>Move: ${rejected.state.join(", ")}</p>
        <p>Reason: ${rejected.reason}</p>
      `;
      rejectedContainer.appendChild(rejectedDiv);
    });

    puzzleContainer.appendChild(rejectedContainer);
  };

  worker.onerror = function (error) {
    alert("Error solving the puzzle: " + error.message);
    loading.style.display = "none";
  };
}
